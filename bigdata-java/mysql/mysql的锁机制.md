# mysql的锁机制

## **乐观锁&悲观锁**

[mysq锁机制](https://www.jianshu.com/p/ed896335b3b4)

## Mysql的事务

事务的特性：ACID

**原子性 aotimic**:事务必须是原子工作单元；对于其数据修改，要么全都执行，要么全都不执行。

**一致性 consistent**:事务在完成时，必须使所有的数据都保持一致状态。

**隔离性 isollaton**:由并发事务所作的修改必须与任何其它并发事务所作的修改隔离。事务查看数据时数据所处的状 态，要么是另一并发事务修改它之前的状态，要么是另一事务修改它之后的状态，事务不会查看中间状态的数据

**持久性 duration**:事务完成后，它对系统的影响是永久性的

## 排它锁&共享锁

**共享锁（shared locks,S锁）**

共享锁又叫读锁，如果事务T1对行R加上S锁，则

- 其它事务T2/T3/Tn只能对行R再加S锁，不能加其它锁

- 获得S锁的事务只能读数据，不能写数据（你傻呀，当然也不能删咯）。

  ```sql
  // start T1
  SELECT * FROM USER WHERE id = 1 lock in share mode; (S锁)
  ......
  
  // start T2
  UPDATE USER SET name = '小明' WHERE id = 1;
  ......
  ```

**排他锁(exclusive locks,X锁)**

排它锁又叫写锁，如果事务T1对行R加上X锁，则

- 其它事务T2/T3/Tn都不能对行R加任何类型的锁，直到T1事务在行R上的X锁释放。

- 获得X锁的事务既能读数据，又能写数据（也可以删除数据）。

## 意向锁（Intention Locks)

**意向锁是表锁，多用在innoDB中，是数据库自身的行为，不需要人工干预，在事务结束后会自行解除。**

意向锁分为意向共享锁(IS锁)和意向排它锁(IX锁)

- 锁：表示事务中将要对某些行加S锁
- IX锁：表示事务中将要对某些行加X锁

意向锁的主要作用是提升存储引擎性能，innoDB中的S锁和X锁是行锁，**每当事务到来时，存储引擎需要遍历所有行的锁持有情况，性能较低**，因此**引入意向锁**，检查行锁前先检查意向锁是否存在，如果存在则阻塞线程。

[其他锁](https://www.jianshu.com/p/904f52bde904)

## Mysql的执行流程

[mysql执行流程](https://www.jianshu.com/p/c5d9ccdb64a0)

  

  

